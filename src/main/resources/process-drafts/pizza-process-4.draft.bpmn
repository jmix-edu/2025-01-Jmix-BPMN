<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:flowable="http://flowable.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:jmix="http://jmix.io/schema/bpm/bpmn" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsd="http://www.w3.org/2001/XMLSchema" targetNamespace="http://www.flowable.org/processdef" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd">
  <process id="pizza-process" name="Pizza process with timer" isExecutable="true" flowable:candidateStarterUsers="peter" jmix:candidateStarterUsersValue="peter">
    <startEvent id="startEvent1" name="Feed developer">
      <extensionElements>
        <jmix:processVariables>
          <jmix:processVariable name="message" type="string" />
          <jmix:processVariable name="pizzaEater" type="entity">
            <jmix:processVariableProperty name="entityName" value="User" />
          </jmix:processVariable>
          <jmix:processVariable name="approver" type="entity">
            <jmix:processVariableProperty name="entityName" value="User" />
          </jmix:processVariable>
          <jmix:processVariable name="specialRequirements" type="string" />
          <jmix:processVariable name="approverMessage" type="string" />
          <jmix:processVariable name="deliveryNumber" type="string" />
          <jmix:processVariable name="pizzaItem" type="entity">
            <jmix:processVariableProperty name="enumClass" value="com.company.jmixbpmdemo.entity.PizzaItem" />
            <jmix:processVariableProperty name="entityName" value="PizzaItem" />
          </jmix:processVariable>
          <jmix:processVariable name="pizzaItems" type="entity-list">
            <jmix:processVariableProperty name="entityName" value="PizzaItem" />
          </jmix:processVariable>
          <jmix:processVariable name="pizzaOrder" type="entity">
            <jmix:processVariableProperty name="entityName" value="PizzaOrder" />
          </jmix:processVariable>
        </jmix:processVariables>
        <jmix:formData type="input-dialog" openMode="DIALOG">
          <jmix:formFields>
            <jmix:formField id="message" caption="Message" type="string" editable="true" required="false" />
            <jmix:formField id="pizzaEater" caption="Pizza eater" type="entity" editable="true" required="true">
              <jmix:formFieldProperty name="entityName" value="User" />
              <jmix:formFieldProperty name="uiComponent" value="comboBox" />
              <jmix:formFieldProperty name="lookupScreen" value="User.list" />
              <jmix:formFieldProperty name="query" value="select u from User u where u.position = &#39;developer&#39;" />
            </jmix:formField>
          </jmix:formFields>
        </jmix:formData>
      </extensionElements>
      <outgoing>Flow_0s4g9wb</outgoing>
    </startEvent>
    <userTask id="Activity_02y1kqp" name="Choose pizza" flowable:assignee="${pizzaEater.username}" jmix:assigneeSource="processVariable" jmix:assigneeValue="pizzaEater">
      <extensionElements>
        <jmix:formData type="input-dialog" openMode="DIALOG">
          <jmix:formFields>
            <jmix:formField id="message" caption="Message" type="string" editable="false" required="false" />
            <jmix:formField id="pizzaItems" caption="Pizza item" type="entity-list" editable="true" required="true">
              <jmix:formFieldProperty name="enumClass" value="com.company.jmixbpmdemo.entity.PizzaItem" />
              <jmix:formFieldProperty name="uiComponent" value="ComboBox" />
              <jmix:formFieldProperty name="entityName" value="PizzaItem" />
            </jmix:formField>
            <jmix:formField id="specialRequirements" caption="Special requirements" type="string" editable="true" required="false" />
          </jmix:formFields>
          <jmix:formOutcomes>
            <jmix:formOutcome id="pizza_chosen" caption="Pizza chosen" icon="THUMBS_O_UP" />
            <jmix:formOutcome id="not_hungry" caption="Not hungry" icon="BAN" />
          </jmix:formOutcomes>
        </jmix:formData>
      </extensionElements>
      <incoming>Flow_02m3azt</incoming>
      <outgoing>Flow_04sng5s</outgoing>
    </userTask>
    <userTask id="Activity_0ysj3jq" name="Approve order" flowable:assignee="${randomRobinUserProvider.getUser()}" jmix:assigneeSource="userProvider" jmix:assigneeValue="randomRobinUserProvider">
      <extensionElements>
        <jmix:formData type="input-dialog" openMode="DIALOG">
          <jmix:formFields>
            <jmix:formField id="pizzaEater" caption="Pizza eater" type="entity" editable="false" required="false">
              <jmix:formFieldProperty name="entityName" value="User" />
              <jmix:formFieldProperty name="uiComponent" value="entityPicker" />
              <jmix:formFieldProperty name="lookupScreen" value="User.list" />
            </jmix:formField>
            <jmix:formField id="pizzaItem" caption="Pizza item" type="platformEnum" editable="false" required="false">
              <jmix:formFieldProperty name="enumClass" value="com.company.jmixbpmdemo.entity.PizzaItem" />
            </jmix:formField>
            <jmix:formField id="approverMessage" caption="Approver message" type="string" editable="true" required="false" />
          </jmix:formFields>
          <jmix:formOutcomes>
            <jmix:formOutcome id="approved" caption="Approved" icon="THUMBS_O_UP" />
            <jmix:formOutcome id="rejected" caption="Rejected" icon="THUMBS_O_DOWN" />
          </jmix:formOutcomes>
        </jmix:formData>
        <jmix:springBean beanName="randomRobinUserProvider" methodName="getUser" />
      </extensionElements>
      <incoming>Flow_0uk2m5z</incoming>
      <outgoing>Flow_0r88pc3</outgoing>
    </userTask>
    <userTask id="Activity_0mhxhyt" name="Place order" flowable:assignee="${initiator.username}" jmix:assigneeSource="processVariable" jmix:assigneeValue="initiator">
      <extensionElements>
        <jmix:formData type="input-dialog" openMode="DIALOG">
          <jmix:formFields>
            <jmix:formField id="approver" caption="Approver" type="entity" editable="false" required="false">
              <jmix:formFieldProperty name="entityName" value="User" />
              <jmix:formFieldProperty name="uiComponent" value="entityPicker" />
              <jmix:formFieldProperty name="lookupScreen" value="User.list" />
            </jmix:formField>
            <jmix:formField id="approverMessage" caption="Approver message" type="string" editable="false" required="false" />
            <jmix:formField id="pizzaEater" caption="Pizza eater" type="entity" editable="false" required="false">
              <jmix:formFieldProperty name="entityName" value="User" />
              <jmix:formFieldProperty name="uiComponent" value="entityPicker" />
              <jmix:formFieldProperty name="lookupScreen" value="User.list" />
            </jmix:formField>
            <jmix:formField id="pizzaItem" caption="Pizza item" type="platformEnum" editable="false" required="false">
              <jmix:formFieldProperty name="enumClass" value="com.company.jmixbpmdemo.entity.PizzaItem" />
            </jmix:formField>
            <jmix:formField id="specialRequirements" caption="Special requirements" type="string" editable="false" required="false" />
            <jmix:formField id="deliveryNumber" caption="Delivery number" type="string" editable="true" required="true" />
          </jmix:formFields>
        </jmix:formData>
      </extensionElements>
      <incoming>Flow_1u19ccq</incoming>
      <outgoing>Flow_1lcscqa</outgoing>
    </userTask>
    <endEvent id="Event_1h2e1z9" name="Enjoy pizza">
      <incoming>Flow_1fgcmzp</incoming>
    </endEvent>
    <sequenceFlow id="Flow_0s4g9wb" sourceRef="startEvent1" targetRef="Activity_0bq1wac" />
    <sequenceFlow id="Flow_04sng5s" sourceRef="Activity_02y1kqp" targetRef="Gateway_0pfjcma">
      <extensionElements>
        <jmix:conditionDetails conditionSource="userTaskOutcome" />
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="Flow_0r88pc3" sourceRef="Activity_0ysj3jq" targetRef="Gateway_1vcx076">
      <extensionElements>
        <jmix:conditionDetails conditionSource="userTaskOutcome" />
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="Flow_1lcscqa" sourceRef="Activity_0mhxhyt" targetRef="Activity_0wl7eng">
      <extensionElements>
        <jmix:conditionDetails conditionSource="userTaskOutcome" />
      </extensionElements>
    </sequenceFlow>
    <exclusiveGateway id="Gateway_0pfjcma">
      <incoming>Flow_04sng5s</incoming>
      <outgoing>Flow_0fm9y35</outgoing>
      <outgoing>Flow_1fo5845</outgoing>
    </exclusiveGateway>
    <exclusiveGateway id="Gateway_1vcx076" default="Flow_0a40e09">
      <incoming>Flow_0r88pc3</incoming>
      <outgoing>Flow_1jghp1d</outgoing>
      <outgoing>Flow_0a40e09</outgoing>
    </exclusiveGateway>
    <endEvent id="Event_0bf4gyj">
      <incoming>Flow_0fm9y35</incoming>
    </endEvent>
    <endEvent id="Event_0kn1tjc">
      <incoming>Flow_09qydc9</incoming>
    </endEvent>
    <sequenceFlow id="Flow_0fm9y35" name="Not hungry" sourceRef="Gateway_0pfjcma" targetRef="Event_0bf4gyj">
      <extensionElements>
        <jmix:conditionDetails conditionSource="userTaskOutcome" conditionType="anyoneCompleted" userTaskId="Activity_02y1kqp" userTaskOutcome="not_hungry" />
      </extensionElements>
      <conditionExpression xsi:type="tFormalExpression">${execution.getVariable('Activity_02y1kqp_result') != null &amp;&amp; bpm_UserTaskResults.containsOutcome(execution.getVariable('Activity_02y1kqp_result'), 'not_hungry')}</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="Flow_1jghp1d" name="Rejected" sourceRef="Gateway_1vcx076" targetRef="Activity_0v87c08">
      <extensionElements>
        <jmix:conditionDetails conditionSource="userTaskOutcome" conditionType="anyoneCompleted" userTaskId="Activity_0ysj3jq" userTaskOutcome="rejected" />
      </extensionElements>
      <conditionExpression xsi:type="tFormalExpression">${execution.getVariable('Activity_0ysj3jq_result') != null &amp;&amp; bpm_UserTaskResults.containsOutcome(execution.getVariable('Activity_0ysj3jq_result'), 'rejected')}</conditionExpression>
    </sequenceFlow>
    <boundaryEvent id="Event_1w2y16u" attachedToRef="Activity_0ysj3jq">
      <outgoing>Flow_1aezgqi</outgoing>
      <timerEventDefinition id="TimerEventDefinition_1gwwskq">
        <timeDuration xsi:type="tFormalExpression">PT15S</timeDuration>
      </timerEventDefinition>
    </boundaryEvent>
    <exclusiveGateway id="Gateway_12jj2df">
      <incoming>Flow_0a40e09</incoming>
      <incoming>Flow_1aezgqi</incoming>
      <outgoing>Flow_0dfospm</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="Flow_0a40e09" sourceRef="Gateway_1vcx076" targetRef="Gateway_12jj2df" />
    <sequenceFlow id="Flow_0dfospm" sourceRef="Gateway_12jj2df" targetRef="Activity_0zigvla" />
    <sequenceFlow id="Flow_1aezgqi" sourceRef="Event_1w2y16u" targetRef="Gateway_12jj2df" />
    <sequenceFlow id="Flow_02m3azt" sourceRef="Activity_0bq1wac" targetRef="Activity_02y1kqp" />
    <sequenceFlow id="Flow_1fo5845" sourceRef="Gateway_0pfjcma" targetRef="Activity_1haa8y8" />
    <sequenceFlow id="Flow_1se5brq" sourceRef="Activity_1haa8y8" targetRef="Activity_0h8jq35" />
    <serviceTask id="Activity_1haa8y8" name="Create pizza order" flowable:type="jmix-create-entity">
      <extensionElements>
        <flowable:field name="entityName">
          <flowable:string>PizzaOrder</flowable:string>
        </flowable:field>
        <flowable:field name="resultVariable">
          <flowable:string>pizzaOrder</flowable:string>
        </flowable:field>
        <flowable:field name="entityAttributes">
          <flowable:string>[{"name":"initiatior","valueType":"directValue"},{"name":"deliveryNumber","valueType":"directValue"}]</flowable:string>
        </flowable:field>
      </extensionElements>
      <incoming>Flow_1fo5845</incoming>
      <outgoing>Flow_1se5brq</outgoing>
    </serviceTask>
    <serviceTask id="Activity_0bq1wac" name="Load pizza items" flowable:type="jmix-load-entities-jpql">
      <extensionElements>
        <flowable:field name="jpql">
          <flowable:string>select p from PizzaItem p where p.id = :'VEGETABLE'</flowable:string>
        </flowable:field>
        <flowable:field name="resultVariable">
          <flowable:string>defaultPizza</flowable:string>
        </flowable:field>
        <flowable:field name="saveLoadResultAs">
          <flowable:string>collection</flowable:string>
        </flowable:field>
      </extensionElements>
      <incoming>Flow_0s4g9wb</incoming>
      <outgoing>Flow_02m3azt</outgoing>
    </serviceTask>
    <sequenceFlow id="Flow_0uk2m5z" sourceRef="Activity_0h8jq35" targetRef="Activity_0ysj3jq" />
    <serviceTask id="Activity_0h8jq35" name="Create order lines" flowable:type="jmix-load-entities-jpql">
      <incoming>Flow_1se5brq</incoming>
      <outgoing>Flow_0uk2m5z</outgoing>
    </serviceTask>
    <sequenceFlow id="Flow_09qydc9" sourceRef="Activity_0v87c08" targetRef="Event_0kn1tjc" />
    <serviceTask id="Activity_0v87c08" name="Set rejected status" flowable:type="jmix-load-entities-jpql">
      <incoming>Flow_1jghp1d</incoming>
      <outgoing>Flow_09qydc9</outgoing>
    </serviceTask>
    <sequenceFlow id="Flow_1u19ccq" sourceRef="Activity_0zigvla" targetRef="Activity_0mhxhyt" />
    <serviceTask id="Activity_0zigvla" name="Set approved status" flowable:type="jmix-load-entities-jpql">
      <incoming>Flow_0dfospm</incoming>
      <outgoing>Flow_1u19ccq</outgoing>
    </serviceTask>
    <sequenceFlow id="Flow_1fgcmzp" sourceRef="Activity_0wl7eng" targetRef="Event_1h2e1z9" />
    <serviceTask id="Activity_0wl7eng" name="Finish order" flowable:type="jmix-load-entities-jpql">
      <incoming>Flow_1lcscqa</incoming>
      <outgoing>Flow_1fgcmzp</outgoing>
    </serviceTask>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_process">
    <bpmndi:BPMNPlane id="BPMNPlane_process" bpmnElement="pizza-process">
      <bpmndi:BPMNShape id="BPMNShape_startEvent1" bpmnElement="startEvent1">
        <omgdc:Bounds x="-218" y="150" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="-238" y="193" width="77" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0xjk5qb_di" bpmnElement="Activity_02y1kqp">
        <omgdc:Bounds x="-10" y="128" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0chxdm5_di" bpmnElement="Activity_0ysj3jq">
        <omgdc:Bounds x="560" y="128" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1v8vbu9_di" bpmnElement="Activity_0mhxhyt">
        <omgdc:Bounds x="1090" y="128" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1h2e1z9_di" bpmnElement="Event_1h2e1z9">
        <omgdc:Bounds x="1442" y="150" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="1431" y="193" width="58" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0pfjcma_di" bpmnElement="Gateway_0pfjcma" isMarkerVisible="true">
        <omgdc:Bounds x="115" y="143" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1vcx076_di" bpmnElement="Gateway_1vcx076" isMarkerVisible="true">
        <omgdc:Bounds x="695" y="143" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0bf4gyj_di" bpmnElement="Event_0bf4gyj">
        <omgdc:Bounds x="122" y="252" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0kn1tjc_di" bpmnElement="Event_0kn1tjc">
        <omgdc:Bounds x="872" y="302" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_12jj2df_di" bpmnElement="Gateway_12jj2df" isMarkerVisible="true">
        <omgdc:Bounds x="815" y="143" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1rgaqzh_di" bpmnElement="Activity_1haa8y8">
        <omgdc:Bounds x="190" y="128" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1cjefho_di" bpmnElement="Activity_0bq1wac">
        <omgdc:Bounds x="-150" y="128" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_12czenk_di" bpmnElement="Activity_0h8jq35">
        <omgdc:Bounds x="360" y="128" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_026vb5p_di" bpmnElement="Activity_0v87c08">
        <omgdc:Bounds x="690" y="280" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1g8th61_di" bpmnElement="Activity_0zigvla">
        <omgdc:Bounds x="940" y="128" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0qlmr7x_di" bpmnElement="Activity_0wl7eng">
        <omgdc:Bounds x="1250" y="128" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1uwhkpa_di" bpmnElement="Event_1w2y16u">
        <omgdc:Bounds x="642" y="110" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0s4g9wb_di" bpmnElement="Flow_0s4g9wb">
        <omgdi:waypoint x="-182" y="168" />
        <omgdi:waypoint x="-150" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_04sng5s_di" bpmnElement="Flow_04sng5s">
        <omgdi:waypoint x="90" y="168" />
        <omgdi:waypoint x="115" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0r88pc3_di" bpmnElement="Flow_0r88pc3">
        <omgdi:waypoint x="660" y="168" />
        <omgdi:waypoint x="695" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1lcscqa_di" bpmnElement="Flow_1lcscqa">
        <omgdi:waypoint x="1190" y="168" />
        <omgdi:waypoint x="1250" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0fm9y35_di" bpmnElement="Flow_0fm9y35">
        <omgdi:waypoint x="140" y="193" />
        <omgdi:waypoint x="140" y="252" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="128" y="219" width="55" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1jghp1d_di" bpmnElement="Flow_1jghp1d">
        <omgdi:waypoint x="720" y="193" />
        <omgdi:waypoint x="720" y="280" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="768" y="257" width="44" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0a40e09_di" bpmnElement="Flow_0a40e09">
        <omgdi:waypoint x="745" y="168" />
        <omgdi:waypoint x="815" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0dfospm_di" bpmnElement="Flow_0dfospm">
        <omgdi:waypoint x="865" y="168" />
        <omgdi:waypoint x="940" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1aezgqi_di" bpmnElement="Flow_1aezgqi">
        <omgdi:waypoint x="660" y="110" />
        <omgdi:waypoint x="660" y="80" />
        <omgdi:waypoint x="840" y="80" />
        <omgdi:waypoint x="840" y="143" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_02m3azt_di" bpmnElement="Flow_02m3azt">
        <omgdi:waypoint x="-50" y="168" />
        <omgdi:waypoint x="-10" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1fo5845_di" bpmnElement="Flow_1fo5845">
        <omgdi:waypoint x="165" y="168" />
        <omgdi:waypoint x="190" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1se5brq_di" bpmnElement="Flow_1se5brq">
        <omgdi:waypoint x="290" y="168" />
        <omgdi:waypoint x="360" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0uk2m5z_di" bpmnElement="Flow_0uk2m5z">
        <omgdi:waypoint x="460" y="168" />
        <omgdi:waypoint x="560" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_09qydc9_di" bpmnElement="Flow_09qydc9">
        <omgdi:waypoint x="790" y="320" />
        <omgdi:waypoint x="872" y="320" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1u19ccq_di" bpmnElement="Flow_1u19ccq">
        <omgdi:waypoint x="1040" y="168" />
        <omgdi:waypoint x="1090" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1fgcmzp_di" bpmnElement="Flow_1fgcmzp">
        <omgdi:waypoint x="1350" y="168" />
        <omgdi:waypoint x="1442" y="168" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
